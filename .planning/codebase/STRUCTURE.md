# Codebase Structure

**Analysis Date:** 2026-01-25

## Directory Layout

```
GenAI Demo/
├── backend/                          # FastAPI backend services
│   ├── __init__.py                  # Package marker
│   ├── main.py                      # FastAPI app and API endpoints
│   ├── ai_service.py                # AI response generation service
│   ├── health_analyzer.py           # Health data analysis service
│   ├── weather_service.py           # Weather integration service
│   ├── models.py                    # Pydantic models for validation
│   └── config.py                    # Environment and configuration
├── frontend/                         # Web UI
│   ├── index.html                   # HTML structure and layout
│   ├── app.js                       # JavaScript client logic
│   └── styles.css                   # CSS styling
├── Whoop Data/                      # Data directory
│   └── whoop_fitness_dataset_100k.csv  # Health metrics dataset (100k records)
├── .planning/                       # Planning and analysis documents
│   └── codebase/                    # Generated codebase analysis
│       ├── ARCHITECTURE.md
│       └── STRUCTURE.md
├── venv/                            # Python virtual environment (not committed)
├── run.py                           # Server startup script
└── .env                             # Environment variables (secrets, not committed)
```

## Directory Purposes

**backend/:**
- Purpose: FastAPI application containing REST API endpoints and business logic services
- Contains: Python modules implementing health analysis, AI integration, weather processing
- Key files: `main.py` (entry point), service modules
- Dependencies: FastAPI, pandas, OpenAI SDK, Anthropic SDK, httpx

**frontend/:**
- Purpose: Single-page web application for user interaction
- Contains: HTML structure, JavaScript logic, CSS styling
- Key files: `index.html` (DOM structure), `app.js` (API client and state)
- No build process: served as static files by FastAPI

**Whoop Data/:**
- Purpose: Data directory containing user health metrics
- Contains: CSV file with 100k records of Whoop wearable sensor data
- Format: Comma-separated values with columns for user_id, date, biometric metrics
- Not generated: Source data from external Whoop dataset

**.planning/codebase/:**
- Purpose: Generated codebase analysis and planning documents
- Contains: Markdown analysis files for architecture, structure, conventions, testing, concerns, integrations, and tech stack
- Generated by: GSD mapper agents
- Not committed to repo: Local analysis artifacts

## Key File Locations

**Entry Points:**

- `run.py`: Server startup script - execute with `python run.py` to start FastAPI on http://localhost:8000
- `backend/main.py`: FastAPI application definition, route handlers, CORS middleware setup
- `frontend/index.html`: HTML entry point, loaded by browser or served via `/` endpoint

**Configuration:**

- `backend/config.py`: Centralized configuration loading (env vars, API keys, paths, model settings)
- `.env`: Environment variables (not tracked in git) - required for API keys
- `package.json` / `requirements.txt`: Not present; dependencies implicit in code imports

**Core Logic:**

- `backend/health_analyzer.py`: HealthAnalyzer service - loads and analyzes Whoop CSV data
- `backend/ai_service.py`: AIService - integrates OpenAI/Anthropic, generates responses and meal plans
- `backend/weather_service.py`: WeatherService - integrates OpenWeatherMap, calculates health impacts
- `backend/models.py`: Pydantic data models for request/response validation

**Testing:**

- No test files present
- No testing framework configured

## Naming Conventions

**Files:**

- **Python modules:** snake_case (e.g., `health_analyzer.py`, `ai_service.py`)
- **HTML/CSS/JS:** lowercase with underscores for compound names (e.g., `app.js`, `styles.css`, `index.html`)
- **Configuration:** config.py, .env convention

**Directories:**

- **Package directories:** lowercase plural (e.g., `backend/`)
- **Data directories:** Capitalized for external data sources (e.g., `Whoop Data/`)
- **Planning directories:** Hidden with dot prefix (e.g., `.planning/`)

**Python Functions/Classes:**

- **Classes:** PascalCase (e.g., `HealthAnalyzer`, `AIService`, `WeatherService`)
- **Functions:** snake_case (e.g., `get_health_analyzer()`, `analyze_sleep_patterns()`)
- **Constants:** UPPER_SNAKE_CASE (e.g., `OPENAI_API_KEY`, `WHOOP_DATA_PATH`)
- **Private methods:** Prefixed with underscore (e.g., `_load_data()`, `_build_context_message()`)

**JavaScript Functions/Variables:**

- **Functions:** camelCase (e.g., `loadUsers()`, `sendChatMessage()`, `updateHealthStats()`)
- **DOM IDs/Classes:** kebab-case (e.g., `chat-messages`, `user-select`, `loading-overlay`)
- **Constants:** camelCase (e.g., `API_BASE`, `currentUserId`)

**Route Endpoints:**

- **Paths:** lowercase with hyphens, plural nouns (e.g., `/api/users`, `/api/chat`)
- **Parameters:** camelCase (e.g., `user_id`, `include_weather`)
- **Query strings:** camelCase (e.g., `?limit=50&days=7`)

## Where to Add New Code

**New Feature (Domain Logic):**

- **Primary code:** Create new service module in `backend/` (e.g., `nutrition_service.py`)
- **Integration point:** Inject into `backend/main.py` as singleton factory
- **Models:** Add Pydantic model to `backend/models.py` for validation
- **Example:** To add hydration tracking, create `backend/hydration_tracker.py` with HydrationTracker class

**New API Endpoint:**

- **Route handler:** Add @app.get() or @app.post() function to `backend/main.py`
- **Location in file:** Group by domain (user endpoints together, health endpoints together)
- **Request model:** Define in `backend/models.py`
- **Response model:** Define in `backend/models.py`
- **Implementation:** Call appropriate service via singleton factory

**New UI Component:**

- **HTML structure:** Add to semantic section in `frontend/index.html`
- **JavaScript logic:** Add function and event listener in `frontend/app.js`
- **Styling:** Add CSS rules to `frontend/styles.css`, use CSS custom properties (--color-*, --text-*, etc.)
- **API calls:** Use existing `fetch()` pattern in `app.js`
- **DOM element references:** Add to `elements` object at top of `app.js`

**New Health Analysis Algorithm:**

- **Implementation:** Add method to `HealthAnalyzer` class in `backend/health_analyzer.py`
- **Pattern:** Follow existing methods - filter by user_id, calculate metrics over window, return Dict
- **Data access:** Use `self.df` pandas DataFrame (loaded from CSV in `__init__`)
- **Integration:** Call from `get_comprehensive_health_context()` or expose as separate endpoint

**Utility Functions:**

- **Shared helpers:** Add to appropriate service module (e.g., weather calculations in `WeatherService`)
- **Data formatting:** Create in service module that uses them (e.g., context message formatting in `AIService`)
- **No separate utils file:** Keep functions close to usage site

## Special Directories

**venv/:**
- Purpose: Python virtual environment for dependency isolation
- Generated: Created by `python -m venv venv`
- Committed: No (included in .gitignore)
- Activation: `source venv/bin/activate` (macOS/Linux) or `venv\Scripts\activate` (Windows)

**Whoop Data/:**
- Purpose: Store health metrics dataset in CSV format
- Generated: No; external data source
- Committed: Likely no (CSV is 100k records, large)
- Format: CSV with columns: user_id, date, age, gender, weight_kg, height_cm, fitness_level, primary_sport, recovery_score, day_strain, sleep_hours, sleep_efficiency, hrv, resting_heart_rate, respiratory_rate, skin_temp_deviation, deep_sleep_hours, rem_sleep_hours, calories_burned, workout_completed, activity_duration_min, activity_strain, activity_type, workout_time_of_day, wake_ups, time_to_fall_asleep_min, hrv_baseline, rhr_baseline

**.planning/codebase/:**
- Purpose: Generated codebase analysis documents
- Generated: Yes; created by GSD mapper
- Committed: Likely yes (markdown analysis, useful for team)
- Contents: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md, STACK.md, INTEGRATIONS.md

## Import Organization Pattern

**Backend (Python):**

```python
# Standard library first
from typing import Optional, Dict, List
from pathlib import Path
from datetime import datetime, timedelta

# Third-party libraries second
import pandas as pd
import numpy as np
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel

# Local imports last
from .models import ChatMessage, ChatResponse
from .health_analyzer import get_health_analyzer
from .config import HOST, PORT
```

**Frontend (JavaScript):**

```javascript
// Constants first
const API_BASE = 'http://localhost:8000/api';

// State second
let currentUserId = 'USER_00001';
let isLoading = false;

// DOM references third
const elements = { /* ... */ };

// Functions last
async function loadUsers() { /* ... */ }
```

## Dependency Patterns

**Singleton Services:**

All major services use singleton factory pattern for reuse across requests:

```python
# In service module
_service_instance = None

def get_service() -> Service:
    global _service_instance
    if _service_instance is None:
        _service_instance = Service()
    return _service_instance
```

Usage in main.py:
```python
analyzer = get_health_analyzer()
service = get_ai_service()
weather = get_weather_service()
```

**Frontend State:**

- Global variables in `app.js` for user selection and loading state
- DOM element cache in `elements` object for efficient selection
- Event listeners centralized in `setupEventListeners()` function

## Module Responsibilities

| Module | Responsibility | Key Classes/Functions | Dependencies |
|--------|-----------------|----------------------|--------------|
| `main.py` | API routing, request handling, conversation management | FastAPI app, route handlers, ChatRequest | models, health_analyzer, ai_service, weather_service |
| `health_analyzer.py` | Health data loading, analysis, insights | HealthAnalyzer, get_health_analyzer() | pandas, config |
| `ai_service.py` | AI response generation, meal planning | AIService, get_ai_service() | openai, anthropic, config |
| `weather_service.py` | Weather fetching, health impact analysis | WeatherService, get_weather_service() | httpx, config |
| `models.py` | Data validation, API contracts | Pydantic models (UserProfile, HealthMetrics, etc.) | pydantic |
| `config.py` | Configuration loading | Path constants, API keys, model names | pathlib, os, dotenv |
| `app.js` | Client-side logic, API calls, UI updates | Event handlers, fetch wrappers, DOM updates | None (browser native) |
| `index.html` | UI structure, semantic markup | HTML elements, CSS classes | None |
| `styles.css` | Styling, layout, responsive design | CSS rules, variables | None |
